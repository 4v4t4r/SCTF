{% extends "sctf/base.html" %}
{% block title %}Security CTF | Teams{% endblock %}
{% load challenges_tags %}
{% block content %}
{% load static %}


<!-- page content -->


<div class="right_col" role="main" style="min-height: 5364px;">
	<div class="">
		<div class="page-title">
			<div class="title_left">
			</div>
		</div>
		<div class="clearfix"></div>

		<div class="row">
			<div class="col-md-12 col-sm-12 col-xs-12">
				<div class="x_panel">
					<div class="x_title">
						<h2 class="blue"><i class="fa fa-home"></i><a class="blue" href="{% url 'index' %}"> HOME</a> > JOIN MANAGEMENT</h2>
						<ul class="nav navbar-right panel_toolbox">
							<li style="margin-left: 46px;"><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
							</li>
						</ul>
						<div class="clearfix"></div>
					</div>
					<div class="x_content">
						<div class="bs-example" data-example-id="simple-jumbotron">
							<div class="jumbotron" style="background-color:#333;">
								<h1 style="text-align: center;color:#fff;"><span class="blue"><i class="fa fa-group"></i> JOIN</span></h1><br>
								<h3 style="text-align:center;color:#fff;"><i class="fa fa-database"></i> Teams:<span class="blue"> #{{teams_count}}</span></h3>
							</div>
						</div>
					</div>
				</div>
			</div>


			<div class="col-md-12 col-sm-12 col-xs-12">
				<div class="x_panel">
					<div class="x_title">
						<h2 class="blue"><i class="fa fa-info-circle"></i> TEAMS LIST</h2>
						<ul class="nav navbar-right panel_toolbox">
							<li style="margin-left: 46px;"><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
							</li>
						</ul>
						<div class="clearfix"></div>
					</div>
					<div class="x_content">
						<p class="text-muted font-13 m-b-30">
						{% lorem 2 %}
						</p>
						<table data-order='[[ 0, "desc" ]]' id="datatable-buttons-team-list" class="table table-striped table-bordered">
							<thead>
								<tr>
									<th style="text-align: center;">Date</th>
									<th style="text-align: center;">User</th>
									<th style="text-align: center;">Status</th>
									<th style="text-align: center;">Manage</th>
									
								</tr>
							</thead>
							{% comment %}
							<tbody>
								{% for request in requests %}
								<tr>
                                    <td style="text-align: center;">{{ request.datetime }}</td>
									<td style="text-align: center;">
										<ul class="list-inline">
											<li>
												<img src="/{{request.user.profile.image.url}}" class="avatar" alt="Avatar">
												<a class="blue" href="{% url 'user' pk=user.pk %}"><font size="0" style="display:block;" >{{request.user.username}}</font></a>
											</li>
										</ul>
									</td>
									<td style="text-align: center;">
                                        {% if request.status == 'P' %}
                                            <label type="label" class="label label-success label-xs">Pending</label>
                                        {% endif %}
                                        {% if request.status == 'A' %}
                                            <label type="label" class="label label-success label-xs">Accepted</label>
                                        {% endif %}
                                        {% if request.status == 'R' %}
                                            <label type="label" class="label label-success label-xs">Rejected</label>
                                        {% endif %}

									</td>
									<td style="text-align: center;">
                                        {% if request.status == 'P' %}
                                            <form method="post" action="{% url 'user_team_request_manage' pk=request.id %}">
                                                {% csrf_token %}
                                                <input type="hidden" name="status" value="A">
                                                <button class="btn btn-info btn-xs" type="submit"><i class="fa fa-pencil"></i>Approve</button>
                                            </form>
                                            <form method="post" action="{% url 'user_team_request_manage' pk=request.id %}">
                                                {% csrf_token %}
                                                <input type="hidden" name="status" value="R">
                                                <button class="btn btn-info btn-xs" type="submit"><i class="fa fa-trash-o"></i>Reject</button>
                                            </form>
                                        {% endif %}
									</td>											
								</tr>
								{% endfor %}
							</tbody>
							{% endcomment %}
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

</div>

{% endblock %}

{% block extra_js %}
<script type="text/javascript">

function load_table(){
	$('#datatable-buttons-team-list').DataTable( {
		"processing": true,
		"serverSide": true,
		"ajax": {
			"url": "{% url 'api-users:user-team-request-list' %}",
			"dataType": "json"
		}
    });
}


events_functions['JOIN_REQUEST'] = function(message){
	$('#badge_join').text(message['num_pending_requests']);
	createNewNotification(
		'New Join Request IN ADMIN TEAM PAGE',
		`User ${message['user_id']} wants to join your team`
	);
	load_table()
};


$(document).ready(function() {
	load_table();
	init_TeamBuddyList();
});

/* DATA TABLES */
function init_TeamBuddyList() {
	console.log('run_datatables');
	if( typeof ($.fn.DataTable) === 'undefined'){ return; }
	console.log('init_DataTables');

	// Page challenges - Team Solves
	var createTable_TeamList = function() {
		if ($("#datatable-buttons-team-list").length) {
			$("#datatable-buttons-team-list").DataTable({
				dom: "Bfrtip",
				buttons: [
				{
					extend: "copy",
					className: "btn-sm"
				},
				{
					extend: "csv",
					className: "btn-sm"
				},
				{
					extend: "print",
					className: "btn-sm"
				},
				],
				responsive: true
			});
		}
	};

	TableManageButtons = function() {
		"use strict";
		return {
			init: function() {
					// Page challenges - Team Solves Table
					createTable_TeamList();
				}
			};
		}();
		TableManageButtons.init();
	}

</script>
{% endblock %}




